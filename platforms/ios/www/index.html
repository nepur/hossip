<!DOCTYPE html>
<html>
    <head>
        <title>Hossip</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
            <meta name="apple-mobile-web-app-capable" content="yes">
            <meta name="apple-mobile-web-app-status-bar-style" content="black">
            <script type="text/javascript" src="cordova-2.6.0.js"></script>
            <link href="css/codiqa.ext.min.css" rel="stylesheet">
            <link href="css/jquery.mobile-1.3.1.min.css" rel="stylesheet">
            <script src="js/jquery-1.9.1.min.js"></script>
            <script src="js/jquery.mobile-1.3.1.min.js"></script>
            <script src="js/codiqa.ext.min.js"></script>
            <script src="js/apigee.js"></script>
            <script src="js/hossip.js"></script>
            <script>
                (function() {
                  var global = global||this,
                    APIGEE_ORGNAME="rupenp",
                    APIGEE_APPNAME="hossip";
                    if("undefined"===typeof APIGEE_ORGNAME || "Your Org Name" === APIGEE_ORGNAME){
                        APIGEE_ORGNAME=prompt("What is the Organization Name you registered at http://apigee.com/usergrid ?\n(you can set this permanently on line 14)", "ORG NAME");
                    }
                    if("undefined"===typeof APIGEE_APPNAME || "Your App Name" === APIGEE_APPNAME){
                        APIGEE_APPNAME=prompt("What is the App Name you created at http://apigee.com/usergrid ?\n(you can set this permanently in on line 15)", "sandbox");
                    }
                    global.APIGEE_ORGNAME=APIGEE_ORGNAME;
                    global.APIGEE_APPNAME=APIGEE_APPNAME;
                })();

            </script>
            <script type="text/javascript">

                if("undefined"===typeof APIGEE_ORGNAME){
                    APIGEE_ORGNAME=prompt("What is the Organization Name you registered at http://apigee.com/usergrid ?\n(you can set this permanently in config.js)", "ORG NAME");
                }
                if("undefined"===typeof APIGEE_APPNAME){
                    APIGEE_APPNAME="sandbox";
                }
                //We start by creating an instance of Apigee.Client to carry our App Services credentials        
                var apigee = new Apigee.Client({
                    orgName:APIGEE_ORGNAME,
                    appName:APIGEE_APPNAME,
                    logging: true, //optional - turn on logging, off by default
                    buildCurl: true //optional - log network calls in the console, off by default

                    
                });
                
                // If you lock down your sandbox or use any other app
                // a user login is required to access the data.
                //apigee.login("myuser","mypass");
                
                var my_patients = new Apigee.Collection( { "client":apigee, "type":"patients", "qs":{"limit":50, "ql":"select *"} } );
                
                // We now define my_books within the global scope
                //var my_books = new Apigee.Collection( { "client":apigee, "type":"books", "qs":{"limit":50, "ql":"select *"} } );
                //my_books = new Usergrid.Collection( { "client":apigee, "type":"books", "qs":{"limit":50, "ql":"order by created desc"} } );

                $(document).ready(function () {
                    $('#create-button').bind('click', createBook);
                    
                    //navigator.geolocation.getCurrentPosition(onSuccess, onError);

                    //loadBooks();
                    loadPatients();
                });
                
                // onSuccess Geolocation
                function onSuccess(position) {
                    alert("Success "+ position.coords.latitude + "," + position.coords.longitude);
                    
                    loadBooks();
                    
                    //var geostring = 'Latitude: ' + position.coords.latitude + '<br />' +
                    //'Longitude: '          + position.coords.longitude             + '<br />' +
                    //'Altitude: '           + position.coords.altitude              + '<br />' +
                    //'Accuracy: '           + position.coords.accuracy              + '<br />' +
                    //'Altitude Accuracy: '  + position.coords.altitudeAccuracy      + '<br />' +
                    //'Heading: '            + position.coords.heading               + '<br />' +
                    //'Speed: '              + position.coords.speed                 + '<br />' +
                    //'Timestamp: '          +                                   position.timestamp          + '<br />';
                    //alert(geostring);
                }
            
                // onError Callback receives a PositionError object
                function onError(error) {
                    alert('code: '    + error.code    + '\n' +
                          'message: ' + error.message + '\n');
                }
            
                function loadPatients () {
                    
                    my_patients.fetch( // Actual network call
                                   
                       // Success Callback
                       function () {
                           $('#patient-list').empty();
                           
                           while ( my_patients.hasNextEntity() ) {
                               var current_patient = my_patients.getNextEntity();
                               
                               // Output the patient on the page
                               
                               $('#patient-list').append('<li data-theme="c"><a href="#" data-transition="slide">'+current_patient.get('full_name')+'<span class="ui-li-count">'+current_patient.get('alert_count')+'</span></a></li>');
                           }
                           
                           // Re-apply jQuery Mobile styles
                           $('#patient-list').listview('refresh');
                       },
                       // Failure Callback
                       function () { alert("read failed"); }
                    );
                }

                function createBook() {

                    new_book = { "title":$("#title-field").val(),
                                    "name":$("#title-field").val(),
                                "author":$("#author-field").val() };

                    my_books.addEntity(new_book, function (error, response) {
                        if (error) {
                            alert('write failed');
                        } else {
                            $("#title-field").val(""), $("#author-field").val("");
                            loadBooks();
                            history.back();
                        }
                    });
                }
            </script>
    </head>
    <body>
        <br><br>
        <div data-role="page" data-control-title="Home" id="page1">
            <div data-theme="c" data-role="header">
                <h1 id="bar">
                    Hossip #FEEDS
                </h1>
            </div>
            <div data-role="content">
                <div id="feed" data-role="navbar" data-iconpos="left">
                    <ul>
                        <li>
                            <a href="#" data-transition="fade" data-theme="" data-icon="gear">
                                Settings
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div data-role="fieldcontain" data-controltype="searchinput">
                    <input name="" id="Search" placeholder="" value="Search" type="search">
                </div>
                <ul id="patient-list" data-role="listview" data-divider-theme="b" data-inset="true">
                    <li data-theme="c">
                        <a href="#" data-transition="slide">
                            #PatientID4321
                            <span class="ui-li-count">
                                3
                            </span>
                        </a>
                    </li>
                    <li data-theme="c">
                        <a href="#page1" data-transition="slide">
                            #PatientID1234
                            <span class="ui-li-count">
                                2
                            </span>
                        </a>
                    </li>
                </ul>
            </div>
            <div id="htabbar" data-role="tabbar" data-iconpos="left" data-theme="c">
                <ul>
                    <li>
                        <a href="#" data-transition="fade" data-theme="" data-icon="plus">
                            Add a feed
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </body>
    <!--
     <body>
     <div data-role="page" data-theme="c" id="page-books-list">
     <div data-role="header" data-theme="b" data-position="fixed">
     <h1>My Books</h1>
     <a href="#page-new-book" id="btn-compose" data-icon="plus" data-iconpos="right" data-inline="true" data-role="button" data-rel="dialog" data-transition="fade" class="ui-btn-right">Add</a>
     </div>
     <div data-role="content">
     <ul id="books-list"  data-role="listview" data-inset="false" >
     <li>
     <h3>First Title</h3>
     <p>First author</p>
     </li>
     <li>
     <h3>Second Title</h3>
     <p>Second author</p>
     </li>
     </ul>
     </div>
     </div>
     
     
     <div data-role="page" data-theme="b" id="page-new-book">
     <div data-role="header" data-theme="b" data-position="fixed">
     <h1>Add a New Book</h1>
     </div>
     <div data-role="content">
     <form>
     <label for="title-field">Title</label>
     <textarea id="title-field"></textarea>
     <label for="author-field">Author</label>
     <textarea id="author-field"></textarea>
     </form>    
     <a data-rel="back" data-role="button" data-theme="c" data-inline="true">Cancel</a>
     <button id="create-button" data-inline="true">Create</button>
     </div>
     </div>
     </body>
     -->
</html>