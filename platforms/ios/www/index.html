<!DOCTYPE html>
<html>
    <head>
        <title>Hossip</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
            <meta name="apple-mobile-web-app-capable" content="yes">
            <meta name="apple-mobile-web-app-status-bar-style" content="black">
            <script type="text/javascript" src="cordova-2.6.0.js"></script>
            <link href="css/codiqa.ext.min.css" rel="stylesheet">
            <link href="css/jquery.mobile-1.3.1.min.css" rel="stylesheet">
            <script src="js/jquery-1.9.1.min.js"></script>
            <script src="js/jquery.mobile-1.3.1.min.js"></script>
            <script src="js/codiqa.ext.min.js"></script>
            <script src="js/apigee.js"></script>
            <script src="js/hossip.js"></script>
            <script>
                (function() {
                  var global = global||this,
                    APIGEE_ORGNAME="rupenp",
                    APIGEE_APPNAME="hossip";
                    if("undefined"===typeof APIGEE_ORGNAME || "Your Org Name" === APIGEE_ORGNAME){
                        APIGEE_ORGNAME=prompt("What is the Organization Name you registered at http://apigee.com/usergrid ?\n(you can set this permanently on line 14)", "ORG NAME");
                    }
                    if("undefined"===typeof APIGEE_APPNAME || "Your App Name" === APIGEE_APPNAME){
                        APIGEE_APPNAME=prompt("What is the App Name you created at http://apigee.com/usergrid ?\n(you can set this permanently in on line 15)", "sandbox");
                    }
                    global.APIGEE_ORGNAME=APIGEE_ORGNAME;
                    global.APIGEE_APPNAME=APIGEE_APPNAME;
                })();

            </script>
            <script type="text/javascript">

                if("undefined"===typeof APIGEE_ORGNAME){
                    APIGEE_ORGNAME=prompt("What is the Organization Name you registered at http://apigee.com/usergrid ?\n(you can set this permanently in config.js)", "ORG NAME");
                }
                if("undefined"===typeof APIGEE_APPNAME){
                    APIGEE_APPNAME="sandbox";
                }
                //We start by creating an instance of Apigee.Client to carry our App Services credentials        
                var apigee = new Apigee.Client({
                    orgName:APIGEE_ORGNAME,
                    appName:APIGEE_APPNAME,
                    logging: true, //optional - turn on logging, off by default
                    buildCurl: true //optional - log network calls in the console, off by default

                    
                });
                
                // If you lock down your sandbox or use any other app
                // a user login is required to access the data.
                //apigee.login("myuser","mypass");
                
                var my_patients = new Apigee.Collection( { "client":apigee, "type":"patients", "qs":{"limit":50, "ql":"select *"} } );
                
                // We now define my_books within the global scope
                //var my_books = new Apigee.Collection( { "client":apigee, "type":"books", "qs":{"limit":50, "ql":"select *"} } );
                //my_books = new Usergrid.Collection( { "client":apigee, "type":"books", "qs":{"limit":50, "ql":"order by created desc"} } );

                $(document).ready(function () {
                    $('#create-button').bind('click', createBook);
                    
                    //navigator.geolocation.getCurrentPosition(onSuccess, onError);

                    //loadBooks();
                    loadPatients();
                });
                
                // onSuccess Geolocation
                function onSuccess(position) {
                    alert("Success "+ position.coords.latitude + "," + position.coords.longitude);
                    
                    loadBooks();
                    
                    //var geostring = 'Latitude: ' + position.coords.latitude + '<br />' +
                    //'Longitude: '          + position.coords.longitude             + '<br />' +
                    //'Altitude: '           + position.coords.altitude              + '<br />' +
                    //'Accuracy: '           + position.coords.accuracy              + '<br />' +
                    //'Altitude Accuracy: '  + position.coords.altitudeAccuracy      + '<br />' +
                    //'Heading: '            + position.coords.heading               + '<br />' +
                    //'Speed: '              + position.coords.speed                 + '<br />' +
                    //'Timestamp: '          +                                   position.timestamp          + '<br />';
                    //alert(geostring);
                }
            
                // onError Callback receives a PositionError object
                function onError(error) {
                    alert('code: '    + error.code    + '\n' +
                          'message: ' + error.message + '\n');
                }
            
                function loadPatients () {
                    
                    my_patients.fetch( // Actual network call
                                   
                       // Success Callback
                       function () {
                           $('#patient-list').empty();
                           
                           while ( my_patients.hasNextEntity() ) {
                               var current_patient = my_patients.getNextEntity();
                               
                               // Output the patient on the page
                               
                               $('#patient-list').append('<li data-theme="c"><a href="#" data-transition="slide">'+current_patient.get('full_name')+'<span class="ui-li-count">'+current_patient.get('alert_count')+'</span></a></li>');
                           }
                           
                           // Re-apply jQuery Mobile styles
                           $('#patient-list').listview('refresh');
                       },
                       // Failure Callback
                       function () { alert("read failed"); }
                    );
                }

                function createBook() {

                    new_book = { "title":$("#title-field").val(),
                                    "name":$("#title-field").val(),
                                "author":$("#author-field").val() };

                    my_books.addEntity(new_book, function (error, response) {
                        if (error) {
                            alert('write failed');
                        } else {
                            $("#title-field").val(""), $("#author-field").val("");
                            loadBooks();
                            history.back();
                        }
                    });
                }
            </script>
    </head>
    <body>
        <br><br>
        <div data-role="page" data-control-title="Home" id="home">
            <div data-theme="c" data-role="header">
                <h1 id="bar">
                    #hossip
                </h1>
            </div>
            <div data-role="content">
                <div id="feed" data-role="navbar" data-iconpos="left">
                    <ul>
                        <li>
                            <a href="#settings" data-transition="fade" data-theme="" data-icon="gear">
                                Settings
                            </a>
                        </li>
                    </ul>
                </div>
                
                <div data-role="fieldcontain" data-controltype="searchinput">
                    <input name="" id="Search" placeholder="" value="Search" type="search">
                </div>
                <ul id="patient-list" data-role="listview" data-divider-theme="b" data-inset="true">
                    <li data-theme="c">
                        <a href="#" data-transition="slide">
                            #PatientID4321
                            <span class="ui-li-count">
                                3
                            </span>
                        </a>
                    </li>
                    <li data-theme="c">
                        <a href="#page1" data-transition="slide">
                            #PatientID1234
                            <span class="ui-li-count">
                                2
                            </span>
                        </a>
                    </li>
                </ul>
            </div>
            <div id="trhome" data-role="tabbar" data-iconpos="left" data-theme="c">
                <ul>
                    <li>
                        <a href="#" data-transition="slidefade" data-theme="" data-icon="plus">
                            Join care team
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div data-role="page" data-control-title="Settings" id="settings">
            <div id="hrsettings" data-theme="c" data-role="header">
                <a id="bksettings" data-role="button" data-rel="back" href="#home" class="ui-btn-left">
                    Back
                </a>
                <h3>
                    Settings
                </h3>
            </div>
            <div data-role="content">
                <div style="display: inline" data-controltype="image">
                    <img style="width: 100px; height: 100px" src="http://lifebydavidpoole.files.wordpress.com/2014/01/david-poole1.jpg">
                        </div>
                <div data-controltype="textblock">
                    <p>
                    <span style="font-family: 'comic sans ms', sans-serif;">
                        <span style="font-size: medium;" data-mce-style="font-size: medium;">
                            Name: FirstName,&nbsp;
                        </span>
                        <span style="font-size: medium;" data-mce-style="font-size: medium;">
                            Last
                        </span>
                        <span style="font-size: medium;" data-mce-style="font-size: medium;">
                            nam
                        </span>
                        <span style="font-size: medium;" data-mce-style="font-size: medium;">
                            e
                            <br>
                        </span>
                        <span style="font-size: medium;" data-mce-style="font-size: medium;">
                            Role: Attending﻿
                        </span>
                    </span>
                    </p>
                </div>
                <div id="checkboxes1" data-role="fieldcontain" data-controltype="checkboxes">
                    <fieldset data-role="controlgroup" data-type="vertical" data-mini="true">
                        <legend>
                            Filter feeds:
                        </legend>
                        <input id="checkbox3" name="" type="checkbox">
                            <label for="checkbox3">
                                Ecnounters
                            </label>
                            <input id="checkbox6" name="" type="checkbox">
                                <label for="checkbox6">
                                    Orders
                                </label>
                                <input id="checkbox5" name="" type="checkbox">
                                    <label for="checkbox5">
                                        Notes
                                    </label>
                                    <input id="checkbox2" name="" type="checkbox">
                                        <label for="checkbox2">
                                            Rad
                                        </label>
                                        <input id="checkbox1" name="" type="checkbox">
                                            <label for="checkbox1">
                                                Labs
                                            </label>
                                            <input id="checkbox4" name="" type="checkbox">
                                                <label for="checkbox4">
                                                    User Messages
                                                </label>
                     </fieldset>
                </div>
            </div>
        </div>
        <!-- Feed page starts here -->
        <div data-role="page" data-control-title="Patient" id="feed">
            <div data-theme="c" data-role="header">
                <a data-role="button" data-rel="back" href="#home" class="ui-btn-left">
                    Back
                </a>
                <h2>
                    #Patient4321
                </h2>
            </div>
            <div data-role="content">
                <div data-role="fieldcontain" data-controltype="searchinput">
                    <input name="Search" id="searchinput2" placeholder="Search" value="" type="search"
                        data-mini="true">
                        </div>
                <div data-controltype="textblock">
                    <p style="text-align: center;" data-mce-style="text-align: center;">
                    <span style="color: rgb(192, 192, 192); font-size: x-small;" data-mce-style="color: #c0c0c0; font-size: x-small;">
                        Applied Filters: Encounters
                    </span>
                    </p>
                </div>
                <hr style="height:1px; background-color:#ccc; border:0; margin-top:12px; margin-bottom:12px;">
                <div data-controltype="textblock">
                    <p>
                    <span style="font-size: small; font-family: 'comic sans ms', sans-serif;"
                        data-mce-style="font-size: small; font-family: 'comic sans ms', sans-serif;">
                        [12:00AM 8/24/2014]&nbsp;Dr H : Patient is now doing well.
                    </span>
                    </p>
                </div>
                <hr style="height:1px; background-color:#ccc; border:0; margin-top:12px; margin-bottom:12px;">
                <div data-controltype="textblock">
                    <p>
                    <span style="font-family: 'comic sans ms', sans-serif; font-size: small;">
                        [11:00PM 8/24/2014]&nbsp;Nurse1: Just checked the patient he is not well.
                    </span>
                    </p>
                </div>
                <hr style="height:1px; background-color:#ccc; border:0; margin-top:12px; margin-bottom:12px;">
                <h5>
                    ..::Today [8/24/2014]
                </h5>
                <hr style="height:3px; background-color:#ccc; border:0; margin-top:12px; margin-bottom:12px;">
                <div data-controltype="textblock">
                    <p>
                    <span style="font-family: 'comic sans ms', sans-serif; font-size: small;"
                        data-mce-style="font-family: 'comic sans ms', sans-serif; font-size: small;">
                        ﻿[11:00AM 8/23/2014]&nbsp;Intern1: Patient admitted.
                    </span>
                    </p>
                </div>
                <hr style="height:1px; background-color:#ccc; border:0; margin-top:12px; margin-bottom:12px;">
                <h5>
                    ..::Yesterday [8/23/2014]
                </h5>
                <div data-role="fieldcontain" data-controltype="textarea">
                    <textarea name="" id="textarea1" placeholder="" data-mini="true"></textarea>
                </div>
                <input type="submit" data-theme="c" value="Submit">
                    </div>
            <div id="trpatient" data-role="tabbar" data-iconpos="left" data-theme="c">
                <ul>
                    <li>
                        <a href="#" data-transition="slidefade" data-theme="" data-icon="info">
                            Team Members
                        </a>
                    </li>
                    <li>
                        <a href="#" data-transition="fade" data-theme="" data-icon="delete">
                            Leave care team
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <!-- Feed page ends here -->
    </body>
    </html>